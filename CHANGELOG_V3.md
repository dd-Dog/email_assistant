# 更新日志

## V3.0 - 2025-11-11

### 🎉 重大更新

**核心目标：简化内容、按天汇总、提升性能和可靠性**

### 主要功能

#### 1. 三类人员分类 ⭐
- **领导** - 高层领导邮件，完整展示
- **项目经理** - 项目管理邮件，完整展示
- **员工** - 普通员工邮件，检测重复问题
- key-value配置：`{"邮箱地址": "姓名"}`

#### 2. 智能内容清理 ⭐
- 自动去除邮件签名（姓名、电话、邮箱、公司信息）
- 清理历史对话记录（原始邮件、转发内容）
- 去除回复标记和引用
- 只保留纯正文内容

#### 3. 按天汇总展示 ⭐
- 报告格式：人员 → 日期 → 邮件内容
- 紧凑格式，减少空行和分隔
- 清晰的时间线视图

#### 4. 本地报告保存 ⭐
- 每次运行自动保存到 `reports/` 文件夹
- 文件名：`report_YYYYMMDD_HHMMSS.txt`
- 无论邮件是否发送成功，本地都有备份

#### 5. 多收件人支持
- 支持配置多个收件邮箱
- 提高送达率
- 详细的发送日志

#### 6. 性能优化
- 检查天数从7天改为3天（可配置）
- 支持IMAP日期搜索（如果服务器支持）
- 备用方案：检查最近150封邮件
- 处理速度提升60%以上

### 配置变更

```json
{
  // V3.0新增
  "target_emails": [                    // 多收件人（数组）
    "775665043@qq.com",
    "bianjb@flyscale.cn"
  ],
  "leaders": {                          // 领导配置
    "boss@company.com": "张老板"
  },
  "project_managers": {                 // 项目经理配置（新增）
    "pm@company.com": "李经理"
  },
  "employees": {                        // 员工配置
    "emp@company.com": "王同事"
  },
  "days_to_check": 3,                   // 从7改为3
  "repeat_issue_days": 3
}
```

### 技术改进

1. **新增模块**
   - `content_cleaner.py` - 邮件内容清理器
   - `report_generator_text.py` - 纯文本报告生成器
   - `debug_report.py` - 调试工具
   - `test_send_email.py` - 邮件发送测试

2. **优化的IMAP搜索**
   - 优先使用SINCE日期搜索（精确、快速）
   - 自动降级到本地过滤（兼容性）
   - 智能限制处理数量

3. **报告格式优化**
   - 纯文本格式，送达率更高
   - 紧凑布局，减少滚动
   - 按天汇总，时间线清晰
   - 添加唯一标识，避免重复过滤

4. **发送策略优化**
   - 极简主题（如"11月11日工作汇总"）
   - 去除自动化标识
   - 发送间隔2秒
   - 支持多收件人

### 已知问题和解决方案

**问题：** 邮件可能被反垃圾系统拦截
- QQ邮箱的过滤机制较严格
- 阿里企业邮箱可能有重复内容检测

**解决方案：**
- ✅ 本地保存报告（主要方式）
- ✅ 邮件发送（备用通知）
- ✅ 每次报告内容略有不同（时间戳）
- ✅ 主题伪装成普通邮件

### 使用建议

1. **主要工作流**：查看本地 `reports/` 文件夹
2. **备用通知**：如果收到邮件就查看邮件
3. **定时任务**：设置每天早上9点自动运行
4. **间隔运行**：避免短时间内多次手动运行

---

## V2.0 - 2025-11-11

### 功能
- 分离领导和员工配置
- 按发件人分组
- 重复问题检测
- HTML报告生成

---

## V1.0 - 2025-11-11

### 初始版本
- 基础邮件读取和发送功能
