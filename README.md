# 邮箱助手 (Email Assistant)

一个智能邮箱助手，用于自动读取、分析和汇总重要邮件内容，帮助您专注于最重要的事项。

## 🌟 功能特点 (V2.0)

1. **自动登录邮箱** - 支持阿里企业邮箱（可配置其他IMAP服务器）
2. **分类监控** - 分别配置领导和员工，针对性处理
3. **智能重复问题检测** - 只对员工邮件检测连续3天的重复问题，领导邮件全部展示
4. **按人分组展示** - 报告中按发件人分组，姓名(邮箱)格式更直观
5. **自动生成报告** - 生成精美的HTML格式每日报告
6. **定时任务** - 每天自动运行，无需人工干预
7. **邮件发送** - 将报告发送到您指定的邮箱

## 📋 系统要求

- Python 3.7 或更高版本
- 阿里企业邮箱账号（或其他支持IMAP/SMTP的邮箱）
- 稳定的网络连接

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置邮箱信息

编辑 `config.json` 文件，填入您的邮箱信息：

```json
{
  "email_account": {
    "username": "your_email@company.com",      // 您的邮箱地址
    "password": "your_password",                // 邮箱密码或授权码
    "imap_server": "imap.qiye.aliyun.com",     // IMAP服务器（阿里企业邮箱）
    "imap_port": 993,                           // IMAP端口
    "smtp_server": "smtp.qiye.aliyun.com",     // SMTP服务器
    "smtp_port": 465                            // SMTP端口
  },
  "target_email": "your_target_email@example.com",  // 接收报告的邮箱
  "leaders": {                                   // 领导配置（邮件全部展示）
    "boss@company.com": "老板",
    "manager@company.com": "经理"
  },
  "employees": {                                 // 员工配置（检测重复问题）
    "colleague1@company.com": "张三",
    "colleague2@company.com": "李四",
    "colleague3@company.com": "王五"
  },
  "schedule_time": "09:00",                      // 每天运行时间
  "days_to_check": 7,                            // 检查最近几天的邮件
  "repeat_issue_days": 3                         // 重复问题的天数阈值
}
```

### 3. 运行方式

#### 方式一：立即运行一次

```bash
python main.py
```

程序会立即读取邮件、分析内容并发送报告。

#### 方式二：启动定时任务

```bash
python scheduler.py
```

程序会在每天指定时间（默认09:00）自动运行。

## 📖 详细配置说明

### 配置参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `username` | 您的邮箱地址 | 必填 |
| `password` | 邮箱密码或授权码 | 必填 |
| `imap_server` | IMAP服务器地址 | imap.qiye.aliyun.com |
| `imap_port` | IMAP端口 | 993 |
| `smtp_server` | SMTP服务器地址 | smtp.qiye.aliyun.com |
| `smtp_port` | SMTP端口 | 465 |
| `target_email` | 接收报告的邮箱地址 | 必填 |
| `leaders` | 领导邮箱配置 {邮箱:姓名} | {} |
| `employees` | 员工邮箱配置 {邮箱:姓名} | {} |
| `schedule_time` | 每天运行时间（24小时制） | "09:00" |
| `days_to_check` | 检查最近几天的邮件 | 7 |
| `repeat_issue_days` | 判定为重复问题的天数 | 3 |

### 阿里企业邮箱设置

阿里企业邮箱已默认开启IMAP/SMTP服务，使用以下配置：

- **IMAP服务器**: `imap.qiye.aliyun.com`，端口 `993`（SSL）
- **SMTP服务器**: `smtp.qiye.aliyun.com`，端口 `465`（SSL）

### 其他邮箱服务器

如果使用其他邮箱，请修改配置文件中的服务器地址：

| 邮箱服务商 | IMAP服务器 | SMTP服务器 |
|-----------|-----------|-----------|
| QQ邮箱 | imap.qq.com:993 | smtp.qq.com:465 |
| 163邮箱 | imap.163.com:993 | smtp.163.com:465 |
| Gmail | imap.gmail.com:993 | smtp.gmail.com:465 |

**注意**：某些邮箱需要使用"授权码"而不是登录密码。

## 📊 报告内容 (V2.0)

生成的HTML报告包含以下内容：

1. **概览统计** - 邮件总数（领导+员工）、重复问题数
2. **🚨 重复问题警报** - 员工邮件中连续3天的重复问题（最优先显示）
3. **👔 领导邮件** - 按发件人分组，完整展示所有内容
4. **👥 员工邮件** - 按发件人分组，排除已显示的重复问题

### 报告示例

报告会以HTML格式呈现，V2.0新增：
- **分类展示**：领导和员工邮件分开
- **按人分组**：每个发件人的邮件单独显示
- **姓名显示**：`姓名(邮箱地址)` 格式更直观
- **重复问题优先**：自动检测员工邮件中的重复问题
- 清晰的视觉层次和颜色区分

## 🔧 高级用法

### Windows 定时任务

在Windows上，可以使用任务计划程序来运行：

1. 打开"任务计划程序"
2. 创建基本任务
3. 触发器：每天指定时间
4. 操作：启动程序
   - 程序/脚本：`python`
   - 参数：`main.py`
   - 起始位置：项目目录路径

### Linux/Mac Cron 任务

在Linux或Mac上，可以使用cron：

```bash
# 编辑crontab
crontab -e

# 添加定时任务（每天09:00运行）
0 9 * * * cd /path/to/email_assistant && python main.py
```

## 📝 日志文件

程序运行时会生成日志文件：`email_assistant_YYYYMMDD.log`

日志包含：
- 连接状态
- 邮件读取情况
- 分析结果
- 发送状态
- 错误信息

## 🐛 故障排除

### 1. 连接失败

**问题**: 无法连接到IMAP/SMTP服务器

**解决方案**:
- 检查网络连接
- 确认服务器地址和端口正确
- 检查防火墙设置

### 2. 登录失败

**问题**: 用户名或密码错误

**解决方案**:
- 确认邮箱地址和密码正确
- 某些邮箱需要使用"授权码"而不是登录密码
- 检查是否开启了IMAP/SMTP服务

### 3. 没有找到邮件

**问题**: 未读取到任何邮件

**解决方案**:
- 检查 `key_senders` 配置是否正确
- 确认时间范围 `days_to_check` 设置是否合理
- 查看日志文件了解详细信息

### 4. 报告未收到

**问题**: 目标邮箱未收到报告

**解决方案**:
- 检查垃圾邮件文件夹
- 确认 `target_email` 配置正确
- 查看日志确认发送是否成功

## 🔐 安全建议

1. **配置文件安全** - `config.json` 包含敏感信息，请妥善保管
2. **使用授权码** - 建议使用邮箱的授权码而不是登录密码
3. **权限设置** - 在Linux/Mac上设置文件权限：
   ```bash
   chmod 600 config.json
   ```
4. **不要提交到版本控制** - 将 `config.json` 添加到 `.gitignore`

## 💡 使用技巧 (V2.0)

1. **合理分类** - 将老板、经理放在 `leaders`，同事放在 `employees`
2. **姓名配置** - 使用真实姓名或昵称，报告更易读
3. **重复问题** - 只有员工邮件会检测重复，领导邮件总是完整显示
4. **时间范围设置** - 根据实际需求调整 `days_to_check`，建议7天
5. **重复问题阈值** - 调整 `repeat_issue_days` 来控制问题检测的敏感度
6. **定时时间** - 选择您每天开始工作的时间作为运行时间

## 📞 技术支持

如有问题或建议，请：
1. 查看日志文件了解详细错误信息
2. 检查配置文件是否正确
3. 确保网络连接正常

## 📄 许可证

本项目仅供个人使用。

## 🎯 未来计划

- [x] ~~分类配置（领导/员工）~~ ✅ V2.0已实现
- [x] ~~按发件人分组展示~~ ✅ V2.0已实现
- [x] ~~姓名显示优化~~ ✅ V2.0已实现
- [ ] 支持更多邮箱服务商
- [ ] AI 智能摘要（集成 GPT）
- [ ] 自定义报告模板
- [ ] 邮件自动分类和优先级
- [ ] Web 管理界面
- [ ] 移动端推送通知

## 📜 版本历史

- **V2.0** (2025-11-11) - 分类配置、按人分组、姓名显示优化
- **V1.0** (2025-11-11) - 初始版本

详见 [CHANGELOG.md](CHANGELOG.md)

---

**祝使用愉快！让邮件助手帮您专注于最重要的工作。** 📧✨

