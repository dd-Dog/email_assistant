# V5.2 迁移指南 - 从config.json到Excel

## 🎯 为什么要迁移？

### 当前问题（V5.1及之前）

```json
// config.json - 人员配置分散在多处
{
  "leaders": {
    "email1": "姓名1",
    "email2": "姓名2",
    ... 重复很多次 ...
  },
  "project_managers": { ... },
  "employees": { ... },
  "customers": { ... },
  "suppliers": { ... }
}
```

**问题：**
- ❌ 信息不完整（只有邮箱和姓名）
- ❌ 维护困难（手动编辑JSON）
- ❌ 容易出错（语法错误）
- ❌ 配置重复（与Excel重复）

### V5.2 解决方案

```
persons/人员信息表.xlsx
├── 所有人员（28人）
├── 详细信息（14个字段）
└── Excel管理（批量编辑）
```

**优势：**
- ✅ 信息完整（技能、经验、项目等）
- ✅ 维护简单（Excel批量操作）
- ✅ 不会出错（可视化编辑）
- ✅ 单一来源（只维护一个地方）

---

## 🚀 快速迁移（3步）

### Step 1：导出到Excel

```bash
python migrate_to_excel.py
```

**效果：**
```
找到 28 个人员
[OK] 成功导出到: persons/人员信息表_迁移.xlsx
```

### Step 2：补充信息（可选）

打开 `persons/人员信息表_迁移.xlsx`，补充详细信息：

| 姓名 | 邮箱 | 类型 | 职位 | 技能 | ... |
|------|------|------|------|------|-----|
| 梁红生 | lianghs@... | leader | 总经理 | (补充) | ... |
| 邢鹏鹏 | xingpp@... | employee | 工程师 | Android,C++ | ... |

### Step 3：启用Excel配置

重命名文件：
```bash
move persons\人员信息表_迁移.xlsx persons\人员信息表.xlsx
```

或直接覆盖模板：
```bash
# 备份原模板（如果需要）
copy persons\人员信息表.xlsx persons\人员信息表_模板备份.xlsx
# 使用迁移的文件
move persons\人员信息表_迁移.xlsx persons\人员信息表.xlsx
```

**完成！运行测试：**
```bash
python test_person_loader.py
python main_v4.py
```

---

## 📋 详细步骤

### 1. 导出人员信息

运行迁移工具：

```bash
python migrate_to_excel.py
```

**输出：**
```
============================================================
配置迁移工具：config.json → Excel
============================================================

找到 28 个人员

  - 9个领导
  - 4个项目经理
  - 12个员工
  - 2个客户
  - 1个供应商

[OK] 成功导出到: persons/人员信息表_迁移.xlsx
```

### 2. 查看导出的Excel

打开 `persons/人员信息表_迁移.xlsx`：

**已填充字段：**
- ✅ 姓名
- ✅ 邮箱
- ✅ 类型 (leader/pm/employee/customer/supplier)
- ✅ 公司（默认值）

**需要补充（可选）：**
- 职位
- 技能
- 工作经验
- 负责项目
- 备注
- ...

### 3. 补充详细信息（推荐）

**领导：**
```
姓名: 梁红生
职位: 总经理
职责: 公司战略和重大决策
```

**员工：**
```
姓名: 邢鹏鹏
职位: 高级软件工程师
技能: Android,C/C++,Linux
负责项目: G20,889
```

**客户：**
```
姓名: 肖正伟
公司: 深圳九胜科技
职位: CTO
技术水平: expert
沟通风格: 技术导向
```

### 4. 激活Excel配置

有两种方式：

**方式A：覆盖模板（推荐）**
```bash
# Windows
move persons\人员信息表_迁移.xlsx persons\人员信息表.xlsx

# 确认覆盖
```

**方式B：重命名**
```bash
# 备份原模板
ren persons\人员信息表.xlsx 人员信息表_模板.xlsx
# 使用迁移文件
ren persons\人员信息表_迁移.xlsx 人员信息表.xlsx
```

### 5. 测试配置

```bash
# 测试人员加载
python test_person_loader.py

# 应该看到
成功加载 28 个人员信息
✅ 使用文件中的人员配置
```

### 6. 清理config.json（可选）

现在Excel是唯一数据源，可以清理config.json：

**修改前：**
```json
{
  "email_account": { ... },
  "leaders": { ... },          ← 可以删除
  "project_managers": { ... }, ← 可以删除
  "employees": { ... },        ← 可以删除
  "customers": { ... },        ← 可以删除
  "suppliers": { ... },        ← 可以删除
  "schedule_time": "09:00",
  ...
}
```

**修改后（简洁版）：**
```json
{
  "email_account": {
    "username": "your_email@company.com",
    "password": "your_password",
    "imap_server": "imap.qiye.aliyun.com",
    "imap_port": 993,
    "smtp_server": "smtp.qiye.aliyun.com",
    "smtp_port": 465
  },
  "target_emails": [
    "report_to@example.com"
  ],
  "schedule_time": "09:00",
  "days_to_check": 1,
  "repeat_issue_days": 3,
  "ai_config": {
    "enabled": true,
    "provider": "openai",
    "api_key": "your_api_key",
    "model": "gpt-4o-mini",
    ...
  }
}
```

**参考：** `config.simple.json`

---

## 🔄 兼容性

### 向后兼容

**V5.2完全兼容旧版本：**

```python
# 加载优先级
1. persons/人员信息表.xlsx    (Excel - 最高优先级)
2. persons/姓名.md             (Markdown)
3. config.json                 (JSON - 兼容旧版本)
```

**如果没有Excel文件，自动使用config.json中的配置**

### 日志输出

**使用Excel：**
```
✅ 使用文件中的人员配置（Excel/Markdown）
领导数量: 9
项目经理数量: 4
员工数量: 12
```

**使用config.json（兼容模式）：**
```
ℹ️  使用config.json中的人员配置（兼容模式）
领导数量: 9
项目经理数量: 4
员工数量: 12
```

---

## 💡 推荐配置

### 新用户（推荐）

**只用Excel：**
```
1. 创建 persons/人员信息表.xlsx
2. 填写所有人员信息
3. config.json 只保留邮箱和AI配置
```

**config.json 保持简洁：**
```json
{
  "email_account": { ... },
  "target_emails": [ ... ],
  "schedule_time": "09:00",
  "days_to_check": 1,
  "ai_config": { ... }
}
```

### 从旧版本迁移

**平滑迁移：**
```
1. 保留config.json中的人员配置（兼容）
2. 运行 migrate_to_excel.py 导出
3. 补充Excel中的详细信息
4. 测试无误后，清理config.json（可选）
```

---

## 📊 对比

| 项目 | config.json | persons/人员信息表.xlsx |
|------|------------|------------------------|
| 维护方式 | 手动编辑JSON | Excel批量操作 |
| 信息完整度 | 只有姓名邮箱 | 14个详细字段 |
| 出错概率 | 容易（语法错误） | 几乎不会 |
| 批量编辑 | 不支持 | 完全支持 |
| 导入导出 | 困难 | 简单 |
| 推荐度 | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## ✅ 迁移检查清单

- [ ] 运行 `migrate_to_excel.py`
- [ ] 打开 `persons/人员信息表_迁移.xlsx`
- [ ] 补充详细信息（可选但推荐）
- [ ] 重命名为 `人员信息表.xlsx`
- [ ] 运行 `test_person_loader.py` 测试
- [ ] 运行 `main_v4.py` 验证
- [ ] 查看日志确认使用Excel配置
- [ ] （可选）清理 config.json 中的人员配置

---

## 🎉 迁移完成！

**恭喜！您现在：**

✅ **统一数据源** - 只需维护Excel  
✅ **信息完整** - 14个详细字段  
✅ **维护简单** - Excel批量操作  
✅ **不会出错** - 可视化编辑  

**从此告别config.json中的人员配置！** 📋✨

